/*!
 * w-converws-client v1.0.1
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ws")):"function"==typeof define&&define.amd?define(["ws"],t):(e=e||self,e["w-converws-client"]=t(e.ws))})(this,function(e){'use strict';function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function r(t){function r(){n(t.open)&&t.open()}function o(){n(t.close)&&t.close()}function i(e){n(t.message)&&t.message(e)}function s(e){n(t.error)&&t.error(e),d.close()}var d=null;t.url||(t.url="ws://localhost:8080"),t.token||(t.token="*");var a,l="undefined"!=typeof window;a=l?window.WebSocket:e;try{d=new a(t.url+"/?token="+t.token)}catch(e){return null}return l?(d.onopen=r,d.onmessage=function(e){var t=e.data;i(t)},d.onclose=o,d.onerror=s):(d.on("open",r),d.on("message",i),d.on("close",o),d.on("error",s)),d}function o(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?J(e):Z(e)}function i(e){return null!=e&&"object"==t(e)}function s(e){return"symbol"==t(e)||ee(e)&&H(e)=="[object Symbol]"}function d(e,n){if(N(e))return!1;var r=t(e);return!!("number"==r||"symbol"==r||"boolean"==r||null==e||te(e))||re.test(e)||!ne.test(e)||null!=n&&e in Object(n)}function a(e){var n=t(e);return null!=e&&("object"==n||"function"==n)}function l(e){return!!ae&&ae in e}function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function p(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function u(e){var n=t(e);return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e}function g(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(_.Cache||Fe),n}function y(e){if("string"==typeof e)return e;if(N(e))return Be(e,y)+"";if(te(e))return Ie?Ie.call(e):"";var t=e+"";return"0"==t&&1/e==-De?"-0":t}function f(){var e,t,n=new Promise(function(){e=arguments[0],t=arguments[1]});return n.resolve=e,n.reject=t,n}function m(e){var t=Object.prototype.toString.call(e);return"[object String]"===t}function h(e){return!!(m(e)&&""!==e)}function O(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t}function L(e){var t=!1;return h(e)?t=!isNaN(+e):O(e)&&(t=!0),t}function j(e){if(!L(e))return 0;var t=nt(e);return t}function k(e){return!!L(e)&&(e=j(e),ot(e))}function E(e){if(!L(e))return 0;e=j(e);var t=at(e);return"0"===t+""?0:t}function x(e){if(!k(e))return!1;var t=0<E(e);return t}function w(){var e,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:32,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[],s=n.length;if(x(t))for(e=0;e<t;e++)o[e]=n[0|Math.random()*s];else if("rfc4122"===t){o[8]=o[13]=o[18]=o[23]="-",o[14]="4";var d;for(e=0;36>e;e++)o[e]||(d=0|16*Math.random(),o[e]=n[19===e?8|3&d:d])}else return"";var a=o.join("");return a}function S(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t}function P(e){if(S(e)){for(var t in e)return!0;return!1}return!1}function z(e,t){return P(e)?h(t)?Qe(e,t,""):"":""}function A(e){if(!h(e)&&!L(e))return"";return e+""}function T(e,t){var n=z(e,t);return n=A(n),n}function R(e){if(!h(e))return{};var t={};try{t=JSON.parse(e)}catch(e){t={}}return t}e=e&&e.hasOwnProperty("default")?e["default"]:e;var V="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,F=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){(function(n){function r(){}function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}function s(e){return!!("function"==typeof e||e instanceof RegExp)||!!(e&&"object"===t(e))&&s(e.listener)}var d=r.prototype,a=n.EventEmitter;d.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},d.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},d.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},d.addListener=function(e,n){if(!s(n))throw new TypeError("listener must be a function");var r,i=this.getListenersAsObject(e),d="object"===t(n);for(r in i)i.hasOwnProperty(r)&&-1===o(i[r],n)&&i[r].push(d?n:{listener:n,once:!1});return this},d.on=i("addListener"),d.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},d.once=i("addOnceListener"),d.defineEvent=function(e){return this.getListeners(e),this},d.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},d.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&(n=o(i[r],t),-1!==n&&i[r].splice(n,1));return this},d.off=i("removeListener"),d.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},d.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},d.manipulateListeners=function(e,n,r){var o,s,d=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"===t(n)&&!(n instanceof RegExp))for(o in n)n.hasOwnProperty(o)&&(s=n[o])&&("function"==typeof s?d.call(this,o,s):a.call(this,o,s));else for(o=r.length;o--;)d.call(this,n,r[o]);return this},d.removeEvent=function(e){var n,r=t(e),o=this._getEvents();if("string"===r)delete o[e];else if(e instanceof RegExp)for(n in o)o.hasOwnProperty(n)&&e.test(n)&&delete o[n];else delete this._events;return this},d.removeAllListeners=i("removeEvent"),d.emitEvent=function(e,t){var n,r,o,s,d,a=this.getListenersAsObject(e);for(s in a)if(a.hasOwnProperty(s))for(n=a[s].slice(0),o=0;o<n.length;o++)r=n[o],!0===r.once&&this.removeListener(e,r.listener),d=r.listener.apply(this,t||[]),d===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},d.trigger=i("emitEvent"),d.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},d.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},d._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},d._getEvents=function(){return this._events||(this._events={})},r.noConflict=function(){return n.EventEmitter=a,r},e.exports?e.exports=r:n.EventEmitter=r})("undefined"==typeof window?V||{}:window)}),C=Array.isArray,N=C,$="object"==t(V)&&V&&V.Object===Object&&V,B="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,D=$||B||Function("return this")(),M=D,I=M.Symbol,G=I,W=Object.prototype,U=W.hasOwnProperty,q=W.toString,Q=G?G.toStringTag:void 0,J=function(e){var t=U.call(e,Q),n=e[Q];try{e[Q]=void 0;var r=!0}catch(t){}var o=q.call(e);return r&&(t?e[Q]=n:delete e[Q]),o},X=Object.prototype,Y=X.toString,Z=function(e){return Y.call(e)},K=G?G.toStringTag:void 0,H=o,ee=i,te=s,ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,re=/^\w*$/,oe=a,ie=function(e){if(!oe(e))return!1;var t=H(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},se=M["__core-js_shared__"],de=se,ae=function(){var e=/[^.]+$/.exec(de&&de.keys&&de.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),le=Function.prototype,ce=le.toString,pe=function(e){if(null!=e){try{return ce.call(e)}catch(t){}try{return e+""}catch(t){}}return""},ue=/[\\^$.*+?()[\]{}|]/g,ge=/^\[object .+?Constructor\]$/,_e=Function.prototype,ye=Object.prototype,fe=_e.toString,me=ye.hasOwnProperty,he=RegExp("^"+fe.call(me).replace(ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),be=function(e){if(!oe(e)||l(e))return!1;var t=ie(e)?he:ge;return t.test(pe(e))},ve=function(e,t){return null==e?void 0:e[t]},Oe=function(e,t){var n=ve(e,t);return be(n)?n:void 0},Le=Oe(Object,"create"),je=Le,ke=Object.prototype,Ee=ke.hasOwnProperty,xe=Object.prototype,we=xe.hasOwnProperty;c.prototype.clear=function(){this.__data__=je?je(null):{},this.size=0},c.prototype["delete"]=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},c.prototype.get=function(e){var t=this.__data__;if(je){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return Ee.call(t,e)?t[e]:void 0},c.prototype.has=function(e){var t=this.__data__;return je?t[e]!==void 0:we.call(t,e)},c.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=je&&void 0===t?"__lodash_hash_undefined__":t,this};var Se=c,Pe=function(e,t){return e===t||e!==e&&t!==t},ze=function(e,t){for(var n=e.length;n--;)if(Pe(e[n][0],t))return n;return-1},Ae=Array.prototype,Te=Ae.splice;p.prototype.clear=function(){this.__data__=[],this.size=0},p.prototype["delete"]=function(e){var t=this.__data__,n=ze(t,e);if(0>n)return!1;var r=t.length-1;return n==r?t.pop():Te.call(t,n,1),--this.size,!0},p.prototype.get=function(e){var t=this.__data__,n=ze(t,e);return 0>n?void 0:t[n][1]},p.prototype.has=function(e){return-1<ze(this.__data__,e)},p.prototype.set=function(e,t){var n=this.__data__,r=ze(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var Re=Oe(M,"Map"),Ve=function(e,t){var n=e.__data__;return u(t)?n["string"==typeof t?"string":"hash"]:n.map};g.prototype.clear=function(){this.size=0,this.__data__={hash:new Se,map:new(Re||p),string:new Se}},g.prototype["delete"]=function(e){var t=Ve(this,e)["delete"](e);return this.size-=t?1:0,t},g.prototype.get=function(e){return Ve(this,e).get(e)},g.prototype.has=function(e){return Ve(this,e).has(e)},g.prototype.set=function(e,t){var n=Ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var Fe=g;_.Cache=Fe;var Ce=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ne=/\\(\\)?/g,$e=function(e){var t=_(e,function(e){return 500===n.size&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ce,function(e,n,r,o){t.push(r?o.replace(Ne,"$1"):n||e)}),t}),Be=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o},De=1/0,Me=G?G.prototype:void 0,Ie=Me?Me.toString:void 0,Ge=function(e){return null==e?"":y(e)},We=function(e,t){return N(e)?e:d(e,t)?[e]:$e(Ge(e))},Ue=function(e){if("string"==typeof e||te(e))return e;var t=e+"";return"0"==t&&1/e==-(1/0)?"-0":t},qe=function(e,t){t=We(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[Ue(t[n++])];return n&&n==r?e:void 0},Qe=function(e,t,n){var r=null==e?void 0:qe(e,t);return r===void 0?n:r},Je=0/0,Xe=/^\s+|\s+$/g,Ye=/^[-+]0x[0-9a-f]+$/i,Ze=/^0b[01]+$/i,Ke=/^0o[0-7]+$/i,He=parseInt,et=function(e){if("number"==typeof e)return e;if(te(e))return Je;if(oe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=oe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Xe,"");var n=Ze.test(e);return n||Ke.test(e)?He(e.slice(2),n?2:8):Ye.test(e)?Je:+e},tt=1/0,nt=function(e){if(!e)return 0===e?e:0;if(e=et(e),e===tt||e===-tt){var t=0>e?-1:1;return 1.7976931348623157e+308*t}return e===e?e:0},rt=function(e){var t=nt(e),n=t%1;return t===t?n?t-n:t:0},ot=function(e){return"number"==typeof e&&e==rt(e)},it=M.isFinite,st=Math.min,dt=function(e){var t=Math[e];return function(e,n){if(e=et(e),n=null==n?0:st(rt(n),292),n&&it(e)){var r=(Ge(e)+"e").split("e"),o=t(r[0]+"e"+(+r[1]+n));return r=(Ge(o)+"e").split("e"),+(r[0]+"e"+(+r[1]-n))}return t(e)}}("round"),at=dt;return function(e){function t(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];setTimeout(function(){a.emit.apply(a,[e].concat(n))},1)}function n(){function n(){t("open")}function l(){i||(t("openOnce"),i=!0)}function c(){t("close"),o()}function p(e){t("error",{msg:"websocket error",err:e}),d.close()}function u(e){var t=R(e);g(t)}function g(e){var n=T(e,"_mode");if("execute"!==n)"broadcast"===n?t("broadcast",Qe(e,"data")):"deliver"===n?t("deliver",Qe(e,"data")):p({msg:"can not find _mode in data",err:e});else if(Qe(e,"_id")&&Qe(e,"output")){var r=Qe(e,"_id");s[r]=e}else t("error",{msg:"can not find _id and output in data",err:e})}function _(e){d.readyState===d.OPEN&&d.send(JSON.stringify(e),function(e){e&&t("error",{msg:"can not send message",err:e})})}e.url||(e.url="ws://localhost:8080"),e.token||(e.token="*");var y={url:e.url,token:e.token,open:function(){n(),l()},close:function(){c()},message:function(e){u(e)},error:function(e){p(e)}};try{d=new r(y)}catch(e){t("error",{msg:"can not create websocket",err:e}),o()}a.removeAllListeners("triggerExecute"),a.on("triggerExecute",function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length?arguments[2]:void 0,o=w();s[o]=null,_({_mode:"execute",_id:o,func:e,input:n});var i=setInterval(function(){if(null!==s[o]){var e=Qe(s[o],"output");delete s[o],r(e),clearInterval(i)}},1e3)}),a.removeAllListeners("triggerBroadcast"),a.on("triggerBroadcast",function(e){_({_mode:"broadcast",data:e})}),a.removeAllListeners("triggerDeliver"),a.on("triggerDeliver",function(e){_({_mode:"deliver",data:e})})}function o(){setTimeout(function(){t("reconn"),n()},1e3)}var i=!1,s={},d=null,a=new F;return a.execute=function(e,n){var r=f();return t("triggerExecute",e,n,function(e){r.resolve(e)}),r},a.broadcast=function(e){t("triggerBroadcast",e)},a.deliver=function(e){t("triggerDeliver",e)},n(),a}});
//# sourceMappingURL=w-converws-client.umd.js.map
