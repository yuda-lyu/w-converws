<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-tw">

    <head>
        <meta http-equiv="content-type" content="text/html charset=UTF-8" />
        <title>w-converws</title>

        <script nomodule src="https://cdn.jsdelivr.net/npm/@babel/polyfill/dist/polyfill.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/wsemi/dist/wsemi.umd.js"></script>
        
        <script src="dist/w-converws-client.umd.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/w-jsonview-tree/dist/w-jsonview-tree.umd.js"></script>
        <script>
            let jv=window['w-jsonview-tree']
            function logData(title,data){
                let id='c'+wsemi.genID()
                let s='<div style="margin:10px;"><div style="display:inline-block; vertical-align:top; margin-right:5px; color:#62f;">'+title+'</div><div id="'+id+'" style="display:inline-block; vertical-align:top;"></div></div>'
                document.querySelector('body').insertAdjacentHTML('beforeend', s)
                let ele=document.querySelector('#'+id)
                if(data){
                    if(wsemi.isnum(data) || wsemi.isstr(data)){
                        ele.innerHTML=data
                    }
                    else{
                        jv(data, ele, {expanded:true})
                        ele.style.marginTop='-4px'
                    }
                }
            }
        </script>
        
        <script>

            let opt = {
                url: 'ws://localhost:8080',
                token: '*',
            }

            //new
            let WConverwsClient=window['w-converws-client']
            let wo = new WConverwsClient(opt)

            wo.on('open', function() {
                logData('client web: open')
            })
            wo.on('openOnce', function() {
                logData('client web: openOnce')

                //execute
                wo.execute('add', { p1: 1, p2: 2 })
                    .then(function(r) {
                        logData('execute: add', r)
                    })

                //broadcast
                wo.broadcast('client web: broadcast: hi')

            })
            wo.on('close', function() {
                logData('client web: close')
            })
            wo.on('error', function(err) {
                logData('client web: error', err)
            })
            wo.on('reconn', function() {
                logData('client web: reconn')
            })
            wo.on('broadcast', function(data) {
                logData('client web: broadcast', data)
            })
            wo.on('deliver', function(data) {
                logData('client web: deliver', data)
            })

        </script>

    </head>

    <body>
    </body>

</html>